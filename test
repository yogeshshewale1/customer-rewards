import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

interface Restaurant {
  id: number;
  name: string;
}

interface Menu {
  id: number;
  restaurantId: number;
  name: string;
  price: number;
}

@Component({
  selector: 'app-user',
  standalone: true,
  imports: [CommonModule, FormsModule],
  template: `
    <h2>User Order Dashboard</h2>

    <!-- STEP 1: Select Restaurant -->
    <div>
      <label>Select Restaurant:</label>
      <select [(ngModel)]="selectedRestaurantId" (change)="onRestaurantChange()">
        <option value="">-- Select --</option>
        <option *ngFor="let r of restaurants" [value]="r.id">
          {{ r.name }}
        </option>
      </select>
    </div>

    <!-- STEP 2: Display Menu -->
    <div *ngIf="filteredMenus.length > 0" style="margin-top:15px">
      <h3>Menu</h3>

      <div *ngFor="let menu of filteredMenus">
        <input
          type="checkbox"
          [checked]="selectedMenuIds.includes(menu.id)"
          (change)="toggleMenu(menu.id)"
        />
        {{ menu.name }} - ₹{{ menu.price }}
      </div>
    </div>

    <!-- STEP 3: Place Order -->
    <div style="margin-top:20px">
      <button (click)="placeOrder()">Place Order</button>
    </div>

    <!-- STEP 4: Confirmation -->
    <div *ngIf="orderStatus === 'SUCCESS'" style="color:green; margin-top:15px">
      ✅ Order placed successfully!
    </div>

    <div *ngIf="orderStatus === 'FAIL'" style="color:red; margin-top:15px">
      ❌ Order failed. Please select restaurant and menu.
    </div>
  `
})
export class UserComponent {

  // Mock Restaurants
  restaurants: Restaurant[] = [
    { id: 1, name: 'Food Hub' },
    { id: 2, name: 'Spice Villa' }
  ];

  // Mock Menus (Assigned to Restaurant)
  menus: Menu[] = [
    { id: 1, restaurantId: 1, name: 'Pizza', price: 250 },
    { id: 2, restaurantId: 1, name: 'Burger', price: 150 },
    { id: 3, restaurantId: 2, name: 'Paneer Masala', price: 220 },
    { id: 4, restaurantId: 2, name: 'Dal Fry', price: 180 }
  ];

  selectedRestaurantId: number | '' = '';
  filteredMenus: Menu[] = [];
  selectedMenuIds: number[] = [];

  orderStatus: 'SUCCESS' | 'FAIL' | '' = '';

  onRestaurantChange() {
    this.filteredMenus = this.menus.filter(
      m => m.restaurantId === Number(this.selectedRestaurantId)
    );
    this.selectedMenuIds = [];
    this.orderStatus = '';
  }

  toggleMenu(menuId: number) {
    if (this.selectedMenuIds.includes(menuId)) {
      this.selectedMenuIds = this.selectedMenuIds.filter(id => id !== menuId);
    } else {
      this.selectedMenuIds.push(menuId);
    }
  }

  placeOrder() {
    if (!this.selectedRestaurantId || this.selectedMenuIds.length === 0) {
      this.orderStatus = 'FAIL';
      return;
    }

    // Simulate API success
    this.orderStatus = 'SUCCESS';

    // Reset after success
    this.selectedRestaurantId = '';
    this.filteredMenus = [];
    this.selectedMenuIds = [];
  }
}
